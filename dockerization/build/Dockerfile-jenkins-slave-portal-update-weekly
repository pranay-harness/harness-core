#For updating image weekly. Use jenkins-slave-portal-open-8u242:kubectl_with_gcc as base_jdk

FROM base_jdk
COPY settings.xml /root/.m2/settings.xml
ENV OVERRIDE_LOCAL_M2 /root/.m2/repository

ARG GITHUB_USERNAME=?
ARG GITHUB_PASSWORD=?

RUN cd /root \
    && git clone https://${GITHUB_USERNAME}:${GITHUB_PASSWORD}@github.com/wings-software/portal.git \
    && cd portal \
    && source /etc/profile.d/maven.sh \
    && mvn -T 2C -Dmaven.repo.local=/root/.m2/repository -s /root/.m2/settings.xml clean install -DskipTests \
    && rm -rf `find . -type d -name target` \
    && rm -rf /home/jenkins/.cache


ENTRYPOINT ["jenkins-slave"]
