pipeline:
  identifier: cipipeline
  name: Integration Pipeline
  description: sample pipeline used for testing
  stages:
    - stage:
        identifier: master-build-upload
        ci:
          description: This stage is run hourly to build binaries from master and upload
          infrastructure:
            type: kubernetes-direct
            spec:
              k8s-connector: MyKubeCluster1
              namespace: ShoppingCart
          connector:
            type: git
            identifier: gitRepo
            spec:
              auth-scheme:
                type: ssh
                ssh-key: git-ssh
              repo: master
          artifact:
            identifier: artifact
            artifact-stream:
              type: docker-hub
              spec:
                dockerhub-connector: "My docker registry"
                image-path: "customer/provided/image"
                tag: 1.1
          container:
            identifier: jenkins-slave-image
            connector: "np-quotecenter"
            imagePath: "us.gcr.io/platform-205701/jenkins-slave-portal-oracle-8u191:12" #if version
          customVariables: #users can specify both in the pipeline & stage level. these vars are available as env vars
            - name: internalPath
              type:
              value: "{input}"
            - name: runTimeVal #will get a value in runtime to be used in a following stage -how?
              type: secret
              value:
          execution:
            steps:
              - step:
                  identifier: git-clone
                  gitClone:
                    gitConnector: git-global
                    path: portal
                    branch: master
              - parallel:
                  - step:
                      identifier: run-lint
                      retryCount: 2
                      timeout: 30
                      run:
                        command:
                          - ./run lint
                  - step:
                      identifier: run-unit-tests
                      retryCount: 2
                      timeout: 30
                      run:
                        command:
                          - mvn -U clean package -Dbuild.number=${BUILD_NUMBER} -DgitBranch=master -DforkMode=perthread -DthreadCount=3 -DargLine="-Xmx2048m"
              - step:
                  identifier: generate-report
                  timeout: 30
                  retryCount: 2
                  run:
                    command:
                      - ./ci/generate_report.sh
              - step:
                  identifier: build-master
                  retryCount: 2
                  timeout: 75
                  run:
                    command:
                      - mvn clean install
              - step:
                  identifier: upload-artifact1
                  publishArtifacts:
                    - dockerFile: ~/Dockerfile
                      image: ui
                      tag: 1.0.0
                      buildArguments:
                        key1: value1
                        key2: value2
                      destination:
                        location: eu.gcr.io/harness/ui:latest
                        connector: myDockerRepoConnector