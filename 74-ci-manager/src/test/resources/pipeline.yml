pipeline:
  identifier: cipipeline
  displayName: Integration Pipeline
  description: sample pipeline used for testing
  stages:
    - stage:
        identifier: masterBuildUpload
        ci:
          description: This stage is run hourly to build binaries from master and upload
          infrastructure:
            type: kubernetes-direct
            spec:
              kubernetesCluster: MyKubeCluster1
              namespace: ShoppingCart
          gitConnector:
            type: git
            identifier: gitRepo
            spec:
              authScheme:
                type: ssh
                sshKey: git-ssh
              repo: master
          container:
            identifier: jenkinsSlaveImage
            connector: "np-quotecenter"
            imagePath: "us.gcr.io/platform-205701/jenkins-slave-portal-oracle-8u191:12" #if version
          customVariables: #users can specify both in the pipeline & stage level. these vars are available as env vars
            - name: internalPath
              type:
              value: "{input}"
            - name: runTimeVal #will get a value in runtime to be used in a following stage -how?
              type: secret
              value:
          execution:
            steps:
              - step:
                  identifier: gitClone
                  gitClone:
                    gitConnector: gitGlobal
                    path: portal
                    branch: master
              - parallel:
                  - step:
                      identifier: runLint
                      retryCount: 2
                      timeout: 30
                      run:
                        command:
                          - ./run lint
                  - step:
                      identifier: runUnitTests
                      retryCount: 2
                      timeout: 30
                      run:
                        command:
                          - mvn -U clean package -Dbuild.number=${BUILD_NUMBER} -DgitBranch=master -DforkMode=perthread -DthreadCount=3 -DargLine="-Xmx2048m"
              - step:
                  identifier: generateReport
                  timeout: 30
                  retryCount: 2
                  run:
                    command:
                      - ./ci/generate_report.sh
              - step:
                  identifier: buildMaster
                  retryCount: 2
                  timeout: 75
                  run:
                    command:
                      - mvn clean install
              - step:
                  identifier: uploadArtifact
                  publishArtifacts:
                    - dockerFile: ~/Dockerfile
                      image: ui
                      tag: 1.0.0
                      buildArguments:
                      - key : key1
                        value: value1
                      - key: key2
                        value: value2
                      gcr:
                        location: eu.gcr.io/harness/ui:latest
                        connector: myDockerRepoConnector