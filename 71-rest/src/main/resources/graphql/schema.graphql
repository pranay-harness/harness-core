directive @dataFetcher(name: String!, contextFieldArgsMap: String, batchLoader: String) on FIELD_DEFINITION

schema {
  query: Query
}

# Harness GraphQL SDL details
type Query {
  # Get details about an application
  application(applicationId: String!): Application @dataFetcher(name: "application")

  #Asking accountID temporarily because there is no auth support as of now.
  #Will remove it once authentication is available
  applications(accountId: String!, limit: Int!, offset: Int): ApplicationConnection
    @dataFetcher(name: "applicationConnection")

  # Get details about an environment
  environment(environmentId: String!): Environment @dataFetcher(name: "environment")

  # Get page data of environments
  environments(applicationId: String!, limit: Int!, offset: Int): EnvironmentConnection
    @dataFetcher(name: "environmentConnection")

  # Get a pipeline object by id
  pipeline(pipelineId: String!): Pipeline @dataFetcher(name: "pipeline")

  pipelines(applicationId: String!, limit: Int!, offset: Int): PipelineConnection
    @dataFetcher(name: "pipelineConnection")

  # Get workflow object by id
  workflow(workflowId: String!): Workflow @dataFetcher(name: "workflow")

  # Get list of workflows for an applicationId. It will return paginated data
  workflows(applicationId: String!, limit: Int!, offset: Int): WorkflowConnection
    @dataFetcher(name: "workflowConnection")

  # Get the execution status of a workflow
  execution(executionId: String!): Execution @dataFetcher(name: "execution")

  # Get the list of executions.
  executionsByApplication(applicationId: String!, limit: Int!, offset: Int): ExecutionConnection
    @dataFetcher(name: "executionConnection")
  executionsByWorkflow(workflowId: String!, limit: Int!, offset: Int): ExecutionConnection
    @dataFetcher(name: "executionConnection")
  executionsByPipeline(pipelineId: String!, limit: Int!, offset: Int): ExecutionConnection
    @dataFetcher(name: "executionConnection")

  # Get list of successfully deployed articacts.
  deployedArtifacts(applicationId: String!, environmentId: String!, serviceId: String!): [Artifact]
    @dataFetcher(name: "artifact")

  # Get count of instances in your application
  # Taking accountId as input temporarily since there is no auth support as of now.
  instanceCount(accountId: String!, instanceCountType: InstanceCountType = TOTAL): InstanceCount
    @dataFetcher(name: "instanceCount")

  instancesByService(serviceId: String, limit: Int!, offset: Int): InstanceConnection
    @dataFetcher(name: "instancesByService")

  instancesByEnvironment(environmentId: String, limit: Int!, offset: Int): InstanceConnection
    @dataFetcher(name: "instancesByEnvironment")

  #Adding accountId as input temporarily since there is no auth support as of now
  instancesByEnvironmentType(accountId: String!, envType: EnvironmentType, limit: Int!, offset: Int): InstanceConnection
    @dataFetcher(name: "instancesByEnvType")

  # Get details about a service
  service(serviceId: String!): Service @dataFetcher(name: "service")

  # Get list of services for applicationId. It will return paginated data
  services(applicationId: String!, limit: Int!, offset: Int): ServiceConnection @dataFetcher(name: "serviceConnection")
}

# Aritifact type
type Artifact {
  # Artifact Id
  id: String
  # Source of the artifact Docker Jenkins
  sourceName: String
  # Display name of the artifact
  displayName: String
  # Build number of the artifiact
  buildNo: String
  # Workflow that successfully deployed it last
  workflowExecutionName: String
  # Pipeline that successfully deployed it last
  pipelineflowExecutionName: String
  # DateTime when artifact was last successfully last
  lastDeployedAt: DateTime
  # Last User who deployed successfully this artifact
  lastDeployedBy: String
  # Application of the artifact
  application: Application
    @dataFetcher(
      name: "application"
      contextFieldArgsMap: "{ \"applicationId\": \"applicationId\"}"
      batchLoader: "application"
    )
}

enum InstanceType {
  PHYSICAL_HOST_INSTANCE
  EC2_CLOUD_INSTANCE
  GCP_CLOUD_INSTANCE
  ECS_CONTAINER_INSTANCE
  KUBERNETES_CONTAINER_INSTANCE
  PCF_INSTANCE
}

type InstanceCount {
  count: Int
  instanceCountType: InstanceCountType
}

type Instance {
  id: String
  type: InstanceType
}

type InstanceConnection {
  pageInfo: PageInfo
  nodes: [Instance]
}

enum InstanceCountType {
  TOTAL
  NINETY_FIVE_PERCENTILE
}
